package controller;

import java.net.URL;
import java.sql.Connection;
import java.sql.Date;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.time.LocalDate;
import java.util.ResourceBundle;

import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.fxml.FXML;
import javafx.fxml.Initializable;
import javafx.scene.control.Alert;
import javafx.scene.control.Button;
import javafx.scene.control.ButtonType;
import javafx.scene.control.DatePicker;
import javafx.scene.control.TableColumn;
import javafx.scene.control.TableView;
import javafx.scene.control.TextField;
import javafx.scene.control.Alert.AlertType;
import javafx.scene.control.cell.PropertyValueFactory;
import javafx.scene.input.MouseEvent;
import models.Agenda;

public class AccueilController implements Initializable {
	
	Connection cnx;
    public PreparedStatement st;
    public ResultSet result ;
    public ObservableList<Agenda> data = FXCollections.observableArrayList();

	

    @FXML
    private DatePicker txt_search;

    @FXML
    private Button search;

    @FXML
    private TableView<Agenda> table_rdv;

    @FXML
    private TableColumn<Agenda, Integer> cln_id;

    @FXML
    private TableColumn<Agenda, String> cln_nom;

    @FXML
    private TableColumn<Agenda, String> cln_prenom;

    @FXML
    private TableColumn<Agenda, String> cln_tel;

    @FXML
    private TableColumn<Agenda, Date> cln_date;

    @FXML
    private TableColumn<Agenda, String> cln_heure;

    @FXML
    void finish(MouseEvent event) {

    }

    @FXML
    void search(MouseEvent event) {
    	LocalDate searchDate = txt_search.getValue();
    	if (searchDate !=null) {
        ObservableList<Agenda> filteredList = data.filtered(RDV -> {
            LocalDate rdvDate = RDV.getDate().toLocalDate();
            return rdvDate.isEqual(searchDate);
        });

        if (!filteredList.isEmpty()) {
            table_rdv.setItems(filteredList);
            table_rdv.getSelectionModel().selectFirst(); // Select the first matching row
        } else {
            table_rdv.getItems().clear(); // Clear the table if no matching rows
            Alert alert = new Alert(AlertType.ERROR, "Aucun Date trouv√© avec  " + searchDate, ButtonType.OK);
            alert.showAndWait();
        }
    }
    	else{
    		Alert alert = new Alert(AlertType.ERROR, "veuillez entrez une date", ButtonType.OK);
            alert.showAndWait();
    	}

    }
    
    public void showAgenda() {
    	table_rdv.getItems().clear();
    	String sql ="select * from agenda";
        try {
			st=cnx.prepareStatement(sql);
			result=st.executeQuery();
			while(result.next()) {
				data.add(new Agenda(result.getInt("idA"),result.getString("nom"),result.getString("prenom"),result.getString("numTel"),result.getDate("dateR"),result.getString("heure")));
			}
		} catch (SQLException e) {

			e.printStackTrace();
		}
        
        cln_id.setCellValueFactory(new PropertyValueFactory<Agenda, Integer>("id"));
        cln_nom.setCellValueFactory(new PropertyValueFactory<Agenda, String>("nom"));
        cln_prenom.setCellValueFactory(new PropertyValueFactory<Agenda, String>("prenom"));
        cln_tel.setCellValueFactory(new PropertyValueFactory<Agenda, String>("tel"));
        cln_date.setCellValueFactory(new PropertyValueFactory<Agenda, Date>("date"));
        cln_heure.setCellValueFactory(new PropertyValueFactory<Agenda, String>("heure"));
        table_rdv.setItems(data);
        
    }

	@Override
	public void initialize(URL arg0, ResourceBundle arg1) {
		// TODO Auto-generated method stub
		
	}

	

}
