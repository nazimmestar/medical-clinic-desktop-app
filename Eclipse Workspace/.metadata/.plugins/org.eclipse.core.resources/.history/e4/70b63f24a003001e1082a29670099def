package controller;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.net.URL;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ResourceBundle;

import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.fxml.FXML;
import javafx.fxml.Initializable;
import javafx.scene.control.Alert;
import javafx.scene.control.Label;
import javafx.scene.control.TableColumn;
import javafx.scene.control.TableView;
import javafx.scene.control.TextField;
import javafx.scene.control.Alert.AlertType;
import javafx.scene.control.cell.PropertyValueFactory;
import javafx.scene.image.ImageView;
import javafx.scene.input.MouseEvent;
import models.Medicament;
import models.Patients;

public class ListeMedicaments implements Initializable {
	
	Connection cnx;
    public PreparedStatement st;
    public ResultSet result ;
    
    private FileInputStream fs;
	
	    @FXML
	    private TextField txt_mdc;

	    @FXML
	    private TextField txt_grp;

	    @FXML
	    private TextField txt_cmp;

	    @FXML
	    private TextField txt_dose;

	    @FXML
	    private ImageView image_mdc;

	    @FXML
	    private Label lab_url;

	    @FXML
	    private TableView<Medicament> table_mdc;
	    
	    @FXML
	    private TableColumn<Medicament, Integer> cln_id;

	    @FXML
	    private TableColumn<Medicament, String> cln_nom;

	    @FXML
	    private TableColumn<Medicament, String> cln_groupe;

	    @FXML
	    private TableColumn<Medicament, String> cln_composition;

	    @FXML
	    private TableColumn<Medicament, String> cln_dose;

	    @FXML
	    private TextField txt_search;
	    
	    public ObservableList<Medicament> data = FXCollections.observableArrayList();


	    @FXML
	    void ajouter(MouseEvent event) {
	    	String mdc = txt_mdc.getText();
	    	String grp = txt_grp.getText();
	    	String cmp = txt_cmp.getText();
	    	String dose = txt_dose.getText();
	    	
	    	File image =new File(lab_url.getText());
	    	
	    	String sql="insert into medicaments (denom,groupe,compo,dose,image) values(?,?,?,?,?)";
	    	if(!mdc.equals("")&&!grp.equals("")&&!cmp.equals("")&&!dose.equals("")) {
	    		try {
					st=cnx.prepareStatement(sql);
					st.setString(1, mdc);
					st.setString(2, grp);
					st.setString(3, cmp);
					st.setString(4, dose);
					fs =new FileInputStream(image);
					st.setBinaryStream(5, fs, image.length());
					st.execute();
					txt_mdc.setText("");
					txt_grp.setText("");
					txt_cmp.setText("");
					txt_dose.setText("");
					Alert alert = new Alert(AlertType.CONFIRMATION,"medicament ajouté avec succès!",javafx.scene.control.ButtonType.OK);
				    alert.showAndWait();
				} catch (SQLException e) {
					e.printStackTrace();
				} catch (FileNotFoundException e) {
					e.printStackTrace();
				}
	    		
	    	}


	    }

	    @FXML
	    void imprter_image(MouseEvent event) {

	    }

	    @FXML
	    void modifier(MouseEvent event) {

	    }

	    @FXML
	    void search(MouseEvent event) {

	    }

	    @FXML
	    void supprimer(MouseEvent event) {

	    }

	
	
	    public void showMdc() {
	    	table_mdc.getItems().clear();
	    	String sql ="select * from medicaments";
	    	try {
				st=cnx.prepareStatement(sql);
				result=st.executeQuery();
				while(result.next()) {
					data.add(new Medicament(result.getInt("idM"),result.getString("denom"),result.getString("groupe"),result.getString("compo"),result.getString("dose")));
				}

			} catch (SQLException e) {
				e.printStackTrace();
			}
	        cln_id.setCellValueFactory(new PropertyValueFactory<Medicament, Integer>("id"));
	        cln_nom.setCellValueFactory(new PropertyValueFactory<Medicament, String>("mdc"));
	        cln_groupe.setCellValueFactory(new PropertyValueFactory<Medicament, String>("compo"));
	        cln_composition.setCellValueFactory(new PropertyValueFactory<Medicament, String>("groupe"));
	        cln_dose.setCellValueFactory(new PropertyValueFactory<Medicament, String>("dose"));
	        table_mdc.setItems(data);



	    }
	    
	    
	    
	@Override
	public void initialize(URL arg0, ResourceBundle arg1) {
		
	}

}
